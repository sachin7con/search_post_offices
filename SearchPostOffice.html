<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>SGN Search PO</title>
    <style>
      .marginL{
        display: flex;
        justify-content: space-between;
      }
      #Lat{
          width: 20%;
      }
      #Long{
          width: 20%;
      }
      #ip{
        color: #B8BCCC;
        font-size: 20px;
      }
      #submit {
        background-color: #575A85;
        color: #B8BCCC;
        border: 1px solid #B8BCCC;
        border-radius: 5px;
        font-size: 15px;
        padding : 10px;
        width: 180px;
        margin-left: 25%;
      }

      body {
          margin: 0;
          font-family: Arial, sans-serif;
           height: 100vh; /* Full viewport height */
          /* display: flex; */
          justify-content: center;
          align-items: center;
      }
      .container {
          display: flex;
          width: 100%;
          height:100vh;
      }

        .column {
            flex: 1; /* Each column takes up equal space */
            padding: 20px;
            box-sizing: border-box;
        }

        .left-column {
            background-color: #000000;
            color: #B8BCCC;
        }
        .left-column h2 {

            color: #575A85;
        }
        .right-column {
            background-color: #575A85;
            color: white;
        }
        .white{
          color:white;
        }

        #searchPage {
          display: none;
          padding: 20px;
          background-color:black;
          color:#B8BCCC;
          }
          #searchPage h2 {
            text-align: center;
          }

        #header, #moreInfo {
            margin-bottom: 20px;
        }

        #header p, #moreInfo p {
            margin: 5px 0;
        }

        #mapbck {
            height: 600px;
            width: 100%;
            background-color: #575A85;
            display: flex;
            justify-content: center;
            align-items: center;
          }

      #mapContainer {
        text-align: center;
      }

      #mapContainer h2 {
        color: white;
        margin-bottom: 20px;
      }

      #map {
        width: 600px;
        height: 450px;
      }


        .postOffice {
            margin: 10px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #fff;
            background-color: #575A85;
            color: white;

        }

        #searchBox input {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color:black;
            color: white;
        }

        #listOfPO {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 20px;
}
        .centered-image {
            margin-left: 30%;
            margin-top: 25%;

        }
        #centeredItem {
            margin-left: 40%;
            margin-top: 30%;

        }

    </style>
</head>
<body>
    <!-- SGN -->
    <div id="container" class="container">
      <div id="left-column" class="column left-column">
        <h2>Post Office Application.</h2>
        <p>This Application Allows you to extract information about the nearest Post Offices, based on your location.</p>
        <img src="./post.svg" alt="post" width="300" height="400" position="center" class="centered-image">
      </div>
      <div id="right-column" class="column right-column">
        <div id="centeredItem">
        <p id="ip">Fetching IP...</p>
        <button type="submit" id="submit">Get Started</button>
    </div></div>
    </div>

    <div id="searchPage">
        <div id="header">
            <br>
            <p id="IPADD">IP Address: </p><br><br>
            <p class="marginL"><span id="Lat">Lat: </span><span id="City"></span> <span id="Organisation"></span></p><br>
            <div class="marginL"><div id="Long">Long: </div><div id="Region"></div> <div id="Hostname"></div></div>
        </div>
        <!-- <div id="mapbck">
          <h2>Your Location</h2>
        <div id="map"></div></div> -->
        <div id="mapbck">
            <div id="mapContainer">
              <h2>Your Location</h2>
              <div id="map"></div>
            </div>
          </div>


        <br><br><br><br>
        <div id="moreInfo">
            <h2>More Information About You</h2>
            <p id="Timezone"></p><br>
            <p id="Datentime"></p><br>
            <p id="Pincode"></p><br>
            <p id="Message"></p>
        </div>

        <div id="searchBox">
            <h2>Post Offices Near You</h2>
            <input type="text" id="searchInput" placeholder="Search By Name">
        </div>

        <div id="listOfPO"></div>
    </div>

    <script>
        const ipElement = document.getElementById("ip");
        const submitElement = document.getElementById("submit");
        const container = document.getElementById("container");
        const searchPage = document.getElementById("searchPage");
        const searchInput = document.getElementById("searchInput");

        // Fetch and display IP
        document.addEventListener('DOMContentLoaded', () => {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    // ipElement.textContent = 'Your Current IP Address is ' + data.ip;
                    ipElement.innerHTML = `Your Current IP Address is  <span class="white"> ${data.ip} </span>`;
                    submitElement.dataset.ip = JSON.stringify(data);
                    // data.ip.style.color="white";
                })
                .catch(error => {
                    console.error('Error fetching IP address:', error);
                    ipElement.textContent = 'Error fetching IP address';
                });
        });

        // Fetch Post Offices
        function fetchPostOffices(pincode) {
            return fetch(`https://api.postalpincode.in/pincode/${pincode}`)
                .then(response => response.json())
                .then(data => {
                    if (data[0].Status === "Success") {
                        return data[0].PostOffice;
                    } else {
                        throw new Error('No post offices found');
                    }
                })
                .catch(error => {
                    console.error('Error fetching post offices:', error);
                    return [];
                });
        }

        // On click submit show search page
        submitElement.addEventListener('click', () => {
            const ipData = JSON.parse(submitElement.dataset.ip);

            // Hide initial container and show search page
            container.style.display = 'none';
            searchPage.style.display = 'block';

            // Fetch and display additional information
            fetch(`https://ipapi.co/${ipData.ip}/json/`)
                .then(response => response.json())
                .then(data => {

                    document.getElementById("IPADD").innerHTML = `IP Address:   <span class="white">${data.ip}</span>`;
                    document.getElementById("Lat").innerHTML = `Lat:   <span class="white">${data.latitude}</span>`;
                    document.getElementById("City").innerHTML = `City:  <span class="white"> ${data.city}</span>`;
                    document.getElementById("Organisation").innerHTML = `Organisation:  <span class="white">${data.org}</span>`;
                    document.getElementById("Long").innerHTML = `Long:  <span class="white">${data.longitude}</span>`;
                    document.getElementById("Region").innerHTML = `Region: <span class="white">${data.region}</span>`;
                    document.getElementById("Hostname").innerHTML = `Hostname: <span class="white">${data.hostname}</span>`;
                    document.getElementById("Timezone").innerHTML = `Timezone: <span class="white">${data.timezone}</span>`;
                    document.getElementById("Datentime").textContent = "Datetime: " + new Date().toLocaleString("en-US", { timeZone: data.timezone });
                    document.getElementById("Pincode").innerHTML = `Postal Code: <span class="white">${data.postal}</span>`;

                    showMap(data.latitude, data.longitude);

                    return fetchPostOffices(data.postal);
                })
                .then(postOffices => {
                    document.getElementById("Message").innerHTML = `Message: <span class="white">${postOffices.length}</span> pincode(s) found`;
                    displayPostOffices(postOffices);
                })
                .catch(error => {
                    console.error('Error fetching additional data', error);
                    document.getElementById("Message").textContent = 'Error fetching additional data';
                });
        });

        function showMap(lat, lon) {
            const mapFrame = document.createElement('iframe');
            mapFrame.src = `https://maps.google.com/maps?q=${lat},${lon}&hl=es&z=14&output=embed`;
            mapFrame.width = "600";
            mapFrame.height = "450";
            document.getElementById('map').appendChild(mapFrame);
        }

        function displayPostOffices(postOffices) {
            const listOfPODiv = document.getElementById('listOfPO');
            listOfPODiv.innerHTML = postOffices.map(postOffice => `
                <div class="postOffice">
                    <p><strong>Name:</strong> ${postOffice.Name}</p>
                    <p><strong>Branch Type:</strong> ${postOffice.BranchType}</p>
                    <p><strong>Delivery Status:</strong> ${postOffice.DeliveryStatus}</p>
                    <p><strong>District:</strong> ${postOffice.District}</p>
                    <p><strong>Division:</strong> ${postOffice.Division}</p>
                </div>
            `).join('');
        }

        // Filter post offices
        searchInput.addEventListener('input', (event) => {
            const filter = event.target.value.toLowerCase();
            const postOffices = document.querySelectorAll('.postOffice');
            postOffices.forEach(po => {
                const name = po.querySelector('p:nth-child(1)').textContent.toLowerCase();
                const branchType = po.querySelector('p:nth-child(2)').textContent.toLowerCase();
                if (name.includes(filter) || branchType.includes(filter)) {
                    po.style.display = '';
                } else {
                    po.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
